# 시스템 아키텍처

## 프로젝트 개요

**목표**: Gemini File Search API를 활용하여 채널별로 격리된 문서 검색 및 질의응답(RAG) 시스템 구축

**핵심 컨셉**: NotebookLM 클론 - 문서 기반 AI 어시스턴트

## 전체 구조

```
┌─────────────────────────────────────────────────────────────────┐
│                         사용자                                   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      FastAPI 서버                                │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 채널 관리    │  │ 파일 업로드  │  │ 질의응답     │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      LangGraph 워크플로우                         │
│  ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐      │
│  │ 입력     │ -> │ 검색    │ -> │ 컨텍스트 │ -> │ 응답생성 │      │
│  │ 처리     │    │         │    │ 구성     │    │         │      │
│  └─────────┘    └─────────┘    └─────────┘    └─────────┘      │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Gemini File Search API                        │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │
│  │ Store A (채널1)  │  │ Store B (채널2)  │  │ Store C (채널3)  │  │
│  │ - 문서1.pdf     │  │ - 논문1.pdf     │  │ - 계약서1.pdf   │  │
│  │ - 문서2.docx    │  │ - 논문2.pdf     │  │ - 계약서2.pdf   │  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

## 핵심 개념

### 채널 (Channel)

- 문서를 그룹화하는 단위
- 1 채널 = 1 Gemini File Search Store
- 채널 간 컨텍스트 격리

### 문서 (Document)

- 채널에 업로드되는 파일
- 지원 형식: PDF, DOCX, TXT, MD, CSV 등
- 최대 100MB/파일

### 질의응답 (Q&A)

- 채널 내 문서를 기반으로 RAG 수행
- 출처(grounding) 정보 포함 응답

## 기술 스택

| 레이어 | 기술 |
|--------|------|
| API 서버 | FastAPI |
| 워크플로우 | LangGraph 1.0 |
| RAG 엔진 | Gemini File Search API |
| LLM | Gemini 2.5 Flash |
| 언어 | Python 3.11+ |
| 테스트 | pytest |

## 디렉토리 구조

```
chalssak/
├── docs/                    # 개발 문서
│   ├── README.md
│   ├── architecture.md      # 이 문서
│   ├── api-spec.md
│   ├── setup.md
│   └── development.md
├── src/                     # 소스 코드
│   ├── api/                 # FastAPI 라우터
│   │   ├── channels.py
│   │   ├── documents.py
│   │   └── chat.py
│   ├── core/                # 핵심 로직
│   │   ├── config.py
│   │   └── dependencies.py
│   ├── services/            # 비즈니스 로직
│   │   ├── channel_service.py
│   │   ├── document_service.py
│   │   └── chat_service.py
│   ├── workflows/           # LangGraph 워크플로우
│   │   ├── rag_workflow.py
│   │   └── nodes/
│   └── main.py              # 앱 진입점
├── tests/                   # 테스트
├── poc/                     # POC 코드
├── .env                     # 환경변수 (Git 제외)
├── .gitignore
├── requirements.txt
└── CLAUDE.md                # Claude Code 지침
```

## 마일스톤

| Phase | 목표 | 상태 |
|-------|------|------|
| 1 | API 분석 및 POC | 완료 |
| 2 | 핵심 백엔드 구현 | 예정 |
| 3 | 채널 생애주기 관리 | 예정 |
| 4 | 확장 기능 (옵션) | 예정 |

## 데이터 흐름

### 채널 생성

```
사용자 요청 -> FastAPI -> channel_service -> Gemini API (Store 생성) -> 응답
```

### 파일 업로드

```
파일 업로드 -> FastAPI -> document_service -> Gemini API (Store에 import) -> 응답
```

### 질의응답

```
질문 -> FastAPI -> LangGraph 워크플로우 -> Gemini API (검색 + 생성) -> 응답
```

## 제약사항

| 항목 | 제한 |
|------|------|
| 파일 크기 | 최대 100MB |
| 저장소 용량 (Free) | 1GB |
| 저장소 용량 (권장) | 20GB 이하/Store |
| 쿼리당 Store | 최대 5개 |
